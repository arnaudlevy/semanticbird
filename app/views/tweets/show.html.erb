<p><%= link_to @tweet.account, @tweet.account %></p>

<blockquote class="blockquote">
  <%= @tweet.text %>
</blockquote>

<%= link_to 'See on twitter', @tweet.url, target: :_blank, class: 'btn btn-primary btn-sm' %>

<script type="text/javascript">
  var app = angular.module('Lexems', []);
  app.controller('LexemsController', function LexemsController($scope, $http) {
    $scope.load = function () {
      $scope.lexemSelected = null;
      $http.get('<%= tweet_path(format: :json) %>')
        .then(function (event) {
          $scope.lexems = event.data.lexems;
        });
    }
    $scope.load();
    $http.get('<%= themes_path(format: :json) %>')
      .then(function (event) {
        $scope.themes = event.data;
      })
    $scope.select = function (lexem) {
      $scope.lexemSelected = lexem;
    }
    $scope.toggle = function (theme) {
      $http.post('/themes/' + theme.id + '/toggle', { lexem: $scope.lexemSelected.value } )
        .then(function (event) {
          $scope.load();
        })
    }
  });
</script>

<div class="lexems mt-5" ng-app="Lexems" ng-controller="LexemsController">
  <div class="row">
    <div class="col-md-8">
      <div  class="lexems__lexem align-top"
            ng-repeat="lexem in lexems"
            ng-click="select(lexem)"
            ng-class="{ 'lexems__lexem--selected': lexem === lexemSelected }">
        <span class="lexems__lexem__index">{{ lexem.index }}</span>
        <span class="lexems__lexem__value">{{ lexem.value }}</span>
        <div class="lexems__lexem__themes">
          <div class="lexem__themes__theme" ng-repeat="theme in lexem.themes">
            {{ theme.name }}
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div ng-show="lexemSelected">
        <div class="themes">
          <div  class="themes__theme btn btn-primary btn-sm me-2 mb-2"
                ng-repeat="theme in themes"
                ng-click="toggle(theme)">
            {{ theme.name }}
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
